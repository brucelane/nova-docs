<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Migration Guide | Nova Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="https://www.meteor.com/favicon.png" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://nova-docs.telescopeapp.org">
    <meta property="og:title" content="Migration Guide | Nova Docs">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@telescopeapp">
    <meta name="twitter:title" content="Migration Guide | Nova Docs">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">
  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      <a class="logo-wrapper" href="http://nova-docs.telescopeapp.org/" title="Nova Documentation Nova Documentation"  >
        Nova Documentation
      </a>
    </div>
  </div>

  <div class="nav-group right">
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://github.com/telescopejs/telescope"  >
          <span>GitHub</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://slack.telescopeapp.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http://nova-docs.telescopeapp.org/" title="Nova Documentation"  >
        <span>Nova Documentation Nova Documentation</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="https://github.com/telescopejs/telescope"  >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://slack.telescopeapp.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Nova Docs</span>
      
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Overview</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="features.html" class="sidebar-link ">
                  <span>Features</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="architecture.html" class="sidebar-link ">
                  <span>Architecture</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="theming.html" class="sidebar-link ">
                  <span>Components & Theming</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="custom-fields.html" class="sidebar-link ">
                  <span>Custom Fields</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="schema.html" class="sidebar-link ">
                  <span>Schema</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="data-layer.html" class="sidebar-link ">
                  <span>Data Layer</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms.html" class="sidebar-link ">
                  <span>Forms</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="callbacks.html" class="sidebar-link ">
                  <span>Callbacks</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="email.html" class="sidebar-link ">
                  <span>Email</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="groups-permissions.html" class="sidebar-link ">
                  <span>Groups & Permissions</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="routing.html" class="sidebar-link ">
                  <span>Routing</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="internationalization.html" class="sidebar-link ">
                  <span>Internationalization</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="settings.html" class="sidebar-link ">
                  <span>Settings</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Tutorials</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="tutorial-framework.html" class="sidebar-link ">
                  <span>Understanding the Nova Framework</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="tutorial-customizing.html" class="sidebar-link ">
                  <span>Customizing & Extending Nova</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Migration Guide</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="deployment.html" class="sidebar-link ">
                  <span>Deployment Guide</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Migration Guide</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/telescopejs/nova-docs/tree/master/source/migration.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <p>As of December 2016, there are three major versions of Telescope:</p>
<ul>
<li>The “Legacy” version, which uses Meteor’s publications and subscriptions and its Blaze front-end framework.</li>
<li>The “Nova Classic” version, which keeps Meteor’s publications and subscriptions but uses React on the front-end. </li>
<li>The “Nova Apollo” version, which replaces Meteor’s publications and subscriptions with Apollo &amp; GraphQL.  </li>
</ul>
<p>This guide focuses on migrating from Nova Classic to Nova Apollo. If you’re still on the Legacy version, I’m afraid there isn’t really an easy migration path and you’re probably best off starting a new codebase from scratch. </p>
<h2 id="Git-Merging"><a href="#Git-Merging" class="headerlink" title="Git Merging"></a>Git Merging</h2><p>The first step will be merging in the latest commits from the <code>apollo</code> branch. I personally use <a href="https://www.sourcetreeapp.com/" target="_blank" rel="external">SourceTree</a> to help manage Git repos, but any good Git app (or even the command line) should work just fine. </p>
<p>I would suggest creating a new local <code>apollo</code> branch (so you can easily go back to your last working version if things don’t work out) first with:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">git</span> checkout -<span class="keyword">B </span>devel-apollo</span><br></pre></td></tr></table></figure>
<p>And then pulling in the changes:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">git pull origin devel</span></span><br></pre></td></tr></table></figure>
<p>This will probably result in at least a few Git conflicts between the old and new versions of the same files. Here are some of the most commonly affected files:</p>
<ul>
<li><code>package.json</code>: fix any conflicts by keeping the most recent version of each package. You can always use a tool like <a href="https://www.npmjs.com/package/depcheck" target="_blank" rel="external">depcheck</a> later to remove unused packages.</li>
<li><code>packages</code>: for this file, it’s probably easiest to just accept the <a href="https://github.com/TelescopeJS/Telescope/blob/apollo/.meteor/packages" target="_blank" rel="external">new version</a> and then manually re-add your own custom packages afterwards. </li>
<li><code>release</code>: just keep the latest Meteor version.</li>
<li><code>versions</code>: this file will be re-generated at runtime, so you can safely pick either version or even delete it for now. </li>
</ul>
<p>For any other file (except those belonging to your own custom packages) you should just use the new version. </p>
<p>Make sure your <code>packages</code> file now contains the following new packages:</p>
<ul>
<li><code>nova:apollo</code></li>
<li><code>nova:routing</code></li>
</ul>
<p>Once you’ve fixed all Git conflicts, it’s time to install any additional NPM packages with <code>npm install</code>. You can now try running your app with the usual <code>meteor</code> command. If you haven’t customized anything, then everything should work more or less fine, and you can stop here!</p>
<p>If however you’ve built your own custom themes and features, you’ll probably have to put in a bit of work. First, start by disabling your customizations and making sure your app runs fine. Once this is done, re-enable your custom packages and read on!</p>
<h2 id="The-Telescope-Namespace"><a href="#The-Telescope-Namespace" class="headerlink" title="The Telescope Namespace"></a>The Telescope Namespace</h2><p>The global Telescope namespace (<code>Telescope.*</code>) has been deprecated in favor of importing individual functions and objects from <code>nova:core</code>. For example, instead of using <code>Telescope.routes.add</code>, you would import <code>{ addRoutes }</code> from <code>meteor/nova:core</code>. </p>
<h2 id="Routes"><a href="#Routes" class="headerlink" title="Routes"></a>Routes</h2><p>Routes are handled a bit differently in Nova Apollo. Instead of having routes definitions (<code>addRoute(...)</code>) and the actual routing code in the same package, route definitions now belong together with themes, while routing code lives in <code>nova:routing</code>. </p>
<p>This means if you had any routing code (e.g. <code>ReactRouterSSR.Run()</code>) in your custom packages, you can now safely remove it and let <code>nova:routing</code> handle it. </p>
<p>Other changes:</p>
<ul>
<li><code>Telescope.routes.routes</code> -&gt; <code>import { Routes } from &#39;meteor/nova:core&#39;</code></li>
<li><code>Telescope.routes.add</code> -&gt; <code>import { addRoute } from &#39;meteor/nova:core&#39;</code></li>
</ul>
<h2 id="Custom-Fields"><a href="#Custom-Fields" class="headerlink" title="Custom Fields"></a>Custom Fields</h2><p>A few schema properties have been changed, and these will trigger schema errors until you update them:</p>
<ul>
<li><code>insertableBy</code> is now <code>insertableBy</code>, and takes either the name of a group or a function. </li>
<li><code>editableBy</code> is now <code>editableBy</code>, and takes either the name of a group or a function. </li>
<li><code>publish</code> is replaced by <code>viewableBy</code>, which works similarly to <code>insertableBy</code> and <code>editableBy</code>. </li>
<li><code>join</code> has been replaced by <code>resolveAs</code>, which you can use to specify a GraphQL resolver for the field.</li>
</ul>
<p>In addition, there are also a few new properties:</p>
<ul>
<li><code>preload</code>, which you can set to <code>true</code> to preload data (only for the <code>Users</code> schema).<h2 id="List-amp-Single-Containers"><a href="#List-amp-Single-Containers" class="headerlink" title="List &amp; Single Containers"></a>List &amp; Single Containers</h2></li>
</ul>
<p>The <code>utilities:smart-publications</code> package has been deprecated, so you can also delete any <code>PublicationUtils.addToFields()</code> calls.</p>
<h2 id="Data-Loading"><a href="#Data-Loading" class="headerlink" title="Data Loading"></a>Data Loading</h2><p>With the move to Apollo, the <code>utilities:react-list-container</code> package is not used anymore, and <code>ListContainer</code> and <code>DocumentContainer</code> are instead replaced with <code>withList</code> and <code>withDocument</code>. </p>
<p>The key difference is that <code>withList</code> is now called directly around the component that needs the data (e.g. <code>export default withList(options)(MyComponent)</code>) unlike <code>ListContainer</code>, which was called from that component’s <em>parent</em> component. </p>
<p>In practice, this means replacing something like this:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListContainer</span> </span><br><span class="line">  <span class="attr">collection</span>=<span class="string">&#123;Posts&#125;</span> </span><br><span class="line">  <span class="attr">publication</span>=<span class="string">"posts.list"</span></span><br><span class="line">  <span class="attr">selector</span>=<span class="string">&#123;selector&#125;</span></span><br><span class="line">  <span class="attr">options</span>=<span class="string">&#123;options&#125;</span></span><br><span class="line">  <span class="attr">terms</span>=<span class="string">&#123;params&#125;</span> </span><br><span class="line">  <span class="attr">joins</span>=<span class="string">&#123;Posts.getJoins()&#125;</span></span><br><span class="line">  <span class="attr">component</span>=<span class="string">&#123;MyPostsList&#125;</span></span><br><span class="line">  <span class="attr">cacheSubscription</span>=<span class="string">&#123;false&#125;</span></span><br><span class="line">  <span class="attr">limit</span>=<span class="string">&#123;20&#125;</span></span><br><span class="line">  <span class="attr">increment</span>=<span class="string">&#123;20&#125;</span></span><br><span class="line">  <span class="attr">listId</span>=<span class="string">&#123;params.listId&#125;</span></span><br><span class="line">/&gt;</span></span><br></pre></td></tr></table></figure>
<p>With:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PostsList</span> <span class="attr">terms</span>=<span class="string">&#123;terms&#125;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>And then wrapping <code>MyPostsList</code> with <code>withList(options)</code> inside <code>MyPostsList.jsx</code>.</p>
<p>Also keep in mind that the data format provided by the GraphQL API can be slightly different from was was previously available (for example, categories are now available on <code>posts.categories</code> instead of <code>posts.categoriesArray</code>). Make sure to check your component’s <code>props</code> in the React inspector if you run into any issues. </p>
<h2 id="Daily-View"><a href="#Daily-View" class="headerlink" title="Daily View"></a>Daily View</h2><p>The daily view now has a slightly different component architecture in the <code>base-components</code> package. </p>
<ul>
<li><code>PostsDaily</code> sets the <code>terms</code> for the view and calls <code>PostsDailyList</code>.</li>
<li><code>PostsDailyList</code> is wrapped with the <code>withList</code> data loading HoC and then iterates over each day, calling <code>PostsDay</code>.</li>
<li><code>PostsDay</code> displays the posts for that day.</li>
</ul>
<p>Note that data loading happens at the <strong>list</strong> level, not at the level of an individual day. In other words, if you’re displaying five days, <strong>all</strong> posts for all five days will be loaded at the same time. </p>
<h2 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h2><p>Component replacement now uses a slightly different syntax. Instead of:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Telescope.components.UsersProfile = MyCustomUsersProfile;</span><br></pre></td></tr></table></figure>
<p>You now write:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Components, replaceComponent &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line">replaceComponent(<span class="string">'UsersProfile'</span>, MyCustomUsersProfile);</span><br></pre></td></tr></table></figure>
<p>And to access a component, you now do:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Components, replaceComponent &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Components.UsersProfile</span>/&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>Finally, to extend a component, instead of</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPostsItem</span> <span class="keyword">extends</span> <span class="title">Telescope</span>.<span class="title">components</span>.<span class="title">PostsItem</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You now write:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">Telescope</span>, &#123; getRawComponent &#125; from <span class="symbol">'meteor</span>/nova:core';</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPostsItem</span> <span class="keyword">extends</span> <span class="title">getRawComponent</span>(<span class="params">'<span class="type">PostsItem</span>'</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>Context is not used to access the current user anymore. Instead, use the <code>withCurrentUser</code> HoC. </p>
<h2 id="Methods-amp-Mutations"><a href="#Methods-amp-Mutations" class="headerlink" title="Methods &amp; Mutations"></a>Methods &amp; Mutations</h2><p>Meteor methods are now replaced with Apollo mutations. Check out the <a href="data-layer.html">data layer</a> section for more info, and make sure to check out the <code>withMutation</code> HoC to take care of simple, one-off mutations. </p>
<h2 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h2><p>The <code>NovaForms</code> component now takes care of its own data loading, and accepts a different set of properties. </p>
<p>Also note that the <code>CanDo</code> component used to test for permissions has been replace with <code>ShowIf</code>. </p>
<h2 id="Other-Changes"><a href="#Other-Changes" class="headerlink" title="Other Changes"></a>Other Changes</h2><h3 id="Callbacks"><a href="#Callbacks" class="headerlink" title="Callbacks"></a>Callbacks</h3><ul>
<li><code>Telescope.callbacks</code> -&gt; <code>import { Callbacks } from &#39;meteor/nova:core&#39;</code></li>
<li><code>Telescope.callbacks.add</code> -&gt; <code>import { addCallback } from &#39;meteor/nova:core&#39;</code></li>
<li><code>Telescope.callbacks.remove</code> -&gt; <code>import { removeCallback } from &#39;meteor/nova:core&#39;</code></li>
<li><code>Telescope.callbacks.run</code> -&gt; <code>import { runCallbacks } from &#39;meteor/nova:core&#39;</code></li>
<li><code>Telescope.callbacks.runAsync</code> -&gt; <code>import { runCallbacksAsync } from &#39;meteor/nova:core&#39;</code></li>
</ul>
<h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h3><ul>
<li><code>Telescope.strings.add</code> -&gt; <code>import { addString } from &#39;meteor/nova:core&#39;</code>;</li>
</ul>
<h3 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h3><ul>
<li><code>Telescope.settings.get</code> -&gt; <code>import { getSetting } from &#39;meteor/nova:core&#39;</code>;</li>
</ul>
<p>Note that using the <code>Settings</code> collection and the <code>nova:settings</code> package are deprecated. </p>
<h3 id="Utils"><a href="#Utils" class="headerlink" title="Utils"></a>Utils</h3><ul>
<li><code>Telescope.utils</code> -&gt; <code>import { Utils } from &#39;meteor/nova:core&#39;</code></li>
</ul>
<h2 id="Database-Migration"><a href="#Database-Migration" class="headerlink" title="Database Migration"></a>Database Migration</h2><p>Once you’re done with every other change, please run <a href="https://gist.github.com/SachaG/99389a6cfbfa94417a39345be256a338" target="_blank" rel="external">this migration</a> which will adapt user profiles by flattening out <code>user.telescope.foo</code> to <code>user.__foo</code>. </p>
<p>To run it, create a <code>/server</code> folder in the root of your app (same level as <code>packages</code>) and copy the code in a <code>migration.js</code> file inside it. </p>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="tutorial-customizing.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Customizing & Extending Nova
        </a>
      
      
        <a class="link primary next"
          href="deployment.html">
          <span class="subtitle-pagination">Next</span>
          Deployment Guide
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/telescopejs/nova-docs/tree/master/source/migration.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/script/smooth-scroll.min.js"></script>
    <script src="/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>


    <script>
      
    </script>
  </body>
</html>
